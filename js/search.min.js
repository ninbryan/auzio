function convert_time(e){var t=e.match(/\d+/g);return e.indexOf("M")>=0&&-1==e.indexOf("H")&&-1==e.indexOf("S")&&(t=[0,t[0],0]),e.indexOf("H")>=0&&-1==e.indexOf("M")&&(t=[t[0],0,t[1]]),e.indexOf("H")>=0&&-1==e.indexOf("M")&&-1==e.indexOf("S")&&(t=[t[0],0,0]),e=0,3==t.length&&(e+=3600*parseInt(t[0]),e+=60*parseInt(t[1]),e+=parseInt(t[2])),2==t.length&&(e+=60*parseInt(t[0]),e+=parseInt(t[1])),1==t.length&&(e+=parseInt(t[0])),e}function getRandom(e,t){return Math.round(Math.random()*(t-e)+e)}function playNextSong(e){if(e){var t=getRandom(0,5);e.random=t,searchQuery(null,e.items[t].snippet.title)}}function getNextSong(e){options=[],options.url=SEARCH_BASE,options.type="GET",options.data={part:"snippet",key:BASE_KEY,api_key:API_KEY,maxResults:6,type:"video",relatedToVideoId:e},vtime.stop(),sendAjaxRequest(options,playNextSong)}function returnDuration(e){var t=e.items[0].contentDetails?e.items[0].contentDetails.duration:"ERROR",n=e.items[0].id?e.items[0].id:"ERROR";if("ERROR"!=t){var o=convert_time(t);o=1e3*o-1700,o=Math.min(36e4,o),vtime.stop(),vtime=new Timer(function(){currentDuration=o,getNextSong(n)},o)}}function sendAjaxRequest(e,t){$.ajax({url:e.url?e.url:"ERROR",beforeSend:function(e){e.setRequestHeader("Accept","*/*"),e.setRequestHeader("Access-Control-Allow-Origin","*")},type:e.type?e.type:"GET",dataType:"json",contentType:"application/json",processData:!0,data:e.data?e.data:{},success:t?t:function(e){console.log("SUCCESS"),console.log(JSON.stringify(e))},error:e.error?e.error:function(e){console.log("ERROR: Cannot get data"),console.log(JSON.stringify(e))}})}function audioController(e){if(""!==currentSong){var t=e?e:window.event;t.stopPropagation(),(t.keyCode||13===t.charCode)&&getNextSong(currentSong),(t.keyCode||32===t.charCode)&&(""===$("iframe#front_player").attr("src")?($("iframe#front_player").attr("src",VIDEO_BASE+currentSong+QS_DATA+"&amp;start="+currentDuration),showVisual(),vtime.resume()):(hideVisual(),vtime.pause()))}}function Timer(e,t){var n,o,i=t,a=i;return this.stop=function(){window.clearTimeout(n)},this.pause=function(){$("span.status").html("Paused..."),window.clearTimeout(n),i-=new Date-o,console.log("remaining:"+i),currentDuration=Math.floor((a-i)/1e3)},this.resume=function(){$("span.status").html("Now playing..."),o=new Date,window.clearTimeout(n),n=window.setTimeout(e,i)},this.resume(),n}window.downloadAudio=function(e){var t=VIDEO_BASE+e;ytdl(t,{filter:function(e){return"mp4"===e.container}}).pipe(fs.createWriteStream("vide.mp4"))};var BASE_FINDERS=" lyrics -kids -kidzbop ",PRE='<span class="pre status">Now playing...</span><br>',POST='<span class="pre"><br><br>controls:<br>[enter] - Next<br>[space] - Pause</span><br>',QS_DATA="?hl=en&amp;autoplay=1&amp;cc_load_policy=0&amp;loop=1&amp;iv_load_policy=0&amp;fs=0&amp;showinfo=0",API_KEY="38RZbrBm78K0K7O5IOuJrH4db7-UFhtKpHWBzmFM",VIDEO_BASE="https://www.youtube.com/embed/",META_BASE="https://www.googleapis.com/youtube/v3/videos",SEARCH_BASE="https://www.googleapis.com/youtube/v3/search",BASE_KEY="AIzaSyA-_35pvz44BvBsUNIKV8Kgs4GCEneQ4a4",vtime=new Timer(null,1e9),videoHistory=[],currentSong="",currentDuration=0;screen.width<=800&&(window.location="../mobile.html");var searchQuery=function(e,t){var n=e?e:window.event;if(n.stopPropagation(),null===e||13===n.keyCode){if(""===t.trim())return void(currentSong&&getNextSong(currentSong));hideVisual(),vtime.stop();var o=[];o.url=SEARCH_BASE,o.type="GET",o.data={part:"snippet",key:BASE_KEY,api_key:API_KEY,maxResults:1,type:"video",videoEmbeddable:"true",q:t+" "+BASE_FINDERS},sendAjaxRequest(o,successCallback)}},getDurationAndNextSong=function(e){options=[],options.url=META_BASE,options.type="GET",options.data={part:"contentDetails",key:BASE_KEY,api_key:API_KEY,type:"video",id:e},sendAjaxRequest(options,returnDuration)},successCallback=function(e){if(e){var t=e.items[0].snippet.title,n=e.items[0].id.videoId,o=$.grep(videoHistory,function(e){return e.index==n});o.length>0&&(console.log("ALREADY PLAYED: "+t),vtime.stop(),getNextSong(n)),t=t.replace(/\(Lyrics\)/gi,""),t=t.replace(/Lyrics/gi,""),t=t.replace(/w\//gi,""),t=t.replace(/\+/gi," "),t=t.replace(/\[/gi,""),t=t.replace(/audio/gi,""),t=t.replace(/video/gi,""),t=t.replace(/\)/gi,""),t=t.replace(/\(/gi,""),t=t.replace(/official/gi,""),t=t.replace(/]/gi,""),t=t.replace(/wmv/gi,""),t=t.replace(/mp3/gi,""),t=t.replace(/\./gi,""),t=t.trim(),$("div#search_result").html(PRE+'<span id="srtitle">'+t+"</span>"+POST),$("iframe#front_player").attr("src",VIDEO_BASE+n+QS_DATA),currentSong=n,videoHistory.push({index:n,title:t}),console.log(videoHistory),console.log(t),window.setTimeout(showVisual,2e3),$("#myInp").trigger("blur"),$("#myInp").val(""),getDurationAndNextSong(n)}},showVisual=function(){$("#bars").fadeIn(1e3)},hideVisual=function(){$("#bars").fadeOut(1e3)};!function(e,t,n,o,i,a,r){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(n),r=t.getElementsByTagName(n)[0],a.async=1,a.src=o,r.parentNode.insertBefore(a,r)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-17692414-10","auto"),ga("send","pageview"),$(document).keypress(function(e){audioController(e),e.preventDefault()});